/**
* @package    JJ_Discord
* @copyright  Copyright (C) 2011 - 2019 JoomJunk. All rights reserved.
* @license    GPL v3.0 or later https://www.gnu.org/licenses/gpl-3.0.html
*/
(()=>{window.addEventListener("DOMContentLoaded",()=>{const s=Joomla.getOptions("discord"),n=document.getElementById("jj-discord"),a={method:"GET",mode:"cors",cache:"reload"};s.server.length>0&&fetch(`https://discordapp.com/api/guilds/${s.server}/widget.json`,a).then(a=>{200==a.status?a.json().then(a=>{const o=a.members;1==s.membersCount&&(document.getElementById("jj-discord-count").innerHTML=`<strong>${o.length}</strong> Members Online`),1==s.connect&&document.getElementById("jj-discord-connect").setAttribute("href",a.instant_invite);const c={};if(a.channels.forEach(({id:e,position:t,name:d})=>{c[e]={position:t,name:d,members:[]}}),o.forEach(e=>{void 0!==e.channel_id&&c[e.channel_id].members.push(e)}),1==s.members){const n=document.getElementById("jj-discord-members");o.forEach(a=>{const o=document.createElement("li");o.classList.add("jj-flex","jj-flex-middle");const c=document.createElement("span");"online"===a.status?c.classList.add("jj-discord-user-status","jj-discord-user-online"):"idle"===a.status?c.classList.add("jj-discord-user-status","jj-discord-user-idle"):c.classList.add("jj-discord-user-status","jj-discord-user-offline"),o.appendChild(e(a.avatar_url)),o.appendChild(c),o.appendChild(d(a)),a.bot&&o.appendChild(t()),1!=s.game||void 0===a.game||a.bot||(memberGame=document.createElement("span"),memberGame.classList.add("jj-discord-game"),memberGame.innerText=` - ${a.game.name}`,o.appendChild(memberGame)),n.appendChild(o)})}Object.keys(c).forEach(e=>{c[c[e].position]=c[e],delete c[e]}),Object.keys(c).forEach(a=>{const o=c[a],r=document.createElement("li");r.innerText=o.name;const i=document.createElement("ul");o.members.forEach(n=>{const a=document.createElement("li");a.classList.add("jj-discord-user");const o=document.createElement("div");o.classList.add("jj-discord-user-left"),o.appendChild(e(n.avatar_url)),o.appendChild(d(n)),n.bot&&o.appendChild(t());const c=document.createElement("div");c.classList.add("jj-discord-user-right"),n.self_mute&&c.insertAdjacentHTML("beforeend",`<img src="${s.root}/media/mod_discord/images/microphone.svg" alt="">`),n.self_deaf&&c.insertAdjacentHTML("beforeend",`<img src="${s.root}/media/mod_discord/images/headset.svg" alt="">`),a.appendChild(o),a.appendChild(c),i.appendChild(a)}),r.appendChild(i),n.appendChild(r)})}):console.log(a.status)}).catch(e=>{console.log(e)})});const e=e=>{const t=document.createElement("img");return t.setAttribute("src",e),t.classList.add("jj-discord-avatar"),t},t=()=>{const e=document.createElement("span");return e.classList.add("jj-discord-bot"),e.innerText="BOT",e},d=e=>{const t=document.createElement("span");return t.innerText=e.nick||e.username,t}})();
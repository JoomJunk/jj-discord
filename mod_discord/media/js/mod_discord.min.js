/**
* @package    JJ_Discord
* @copyright  Copyright (C) 2011 - 2019 JoomJunk. All rights reserved.
* @license    GPL v3.0 or later https://www.gnu.org/licenses/gpl-3.0.html
*/
(()=>{window.addEventListener("DOMContentLoaded",()=>{const s=Joomla.getOptions("discord"),n=document.getElementById("jj-discord"),o={method:"GET",mode:"cors",cache:"reload"};s.server.length>0&&fetch(`https://discordapp.com/api/guilds/${s.server}/widget.json`,o).then(o=>{200==o.status?o.json().then(o=>{const a=o.members;if(1==s.membersCount&&(document.getElementById("jj-discord-count").innerHTML=`<strong>${a.length}</strong> Members Online`),1==s.connect){const e=o.instant_invite.replace("https","discord");document.getElementById("jj-discord-connect").setAttribute("href",e)}const c={};if(o.channels.forEach(({id:e,position:t,name:d})=>{c[e]={position:t,name:d,members:[]}}),a.forEach(e=>{void 0!==e.channel_id&&c[e.channel_id].members.push(e)}),1==s.members){const n=document.getElementById("jj-discord-members");a.forEach(o=>{const a=document.createElement("li");a.classList.add("jj-flex","jj-flex-middle");const c=document.createElement("span");"online"===o.status?c.classList.add("jj-discord-user-status","jj-discord-user-online"):"idle"===o.status?c.classList.add("jj-discord-user-status","jj-discord-user-idle"):c.classList.add("jj-discord-user-status","jj-discord-user-offline"),a.appendChild(e(o.avatar_url)),a.appendChild(c),a.appendChild(d(o)),o.bot&&a.appendChild(t()),1!=s.game||void 0===o.game||o.bot||(memberGame=document.createElement("span"),memberGame.classList.add("jj-discord-game"),memberGame.innerText=` - ${o.game.name}`,a.appendChild(memberGame)),n.appendChild(a)})}Object.keys(c).forEach(e=>{c[c[e].position]=c[e],delete c[e]}),Object.keys(c).forEach(o=>{const a=c[o],r=document.createElement("li");r.innerText=a.name;const i=document.createElement("ul");a.members.forEach(n=>{const o=document.createElement("li");o.classList.add("jj-discord-user");const a=document.createElement("div");a.classList.add("jj-discord-user-left"),a.appendChild(e(n.avatar_url)),a.appendChild(d(n)),n.bot&&a.appendChild(t());const c=document.createElement("div");c.classList.add("jj-discord-user-right"),n.self_mute&&c.insertAdjacentHTML("beforeend",`<img src="${s.root}/media/mod_discord/images/microphone.svg" alt="">`),n.self_deaf&&c.insertAdjacentHTML("beforeend",`<img src="${s.root}/media/mod_discord/images/headset.svg" alt="">`),o.appendChild(a),o.appendChild(c),i.appendChild(o)}),r.appendChild(i),n.appendChild(r)})}):console.log(o.status)}).catch(e=>{console.log(e)})});const e=e=>{const t=document.createElement("img");return t.setAttribute("src",e),t.classList.add("jj-discord-avatar"),t},t=()=>{const e=document.createElement("span");return e.classList.add("jj-discord-bot"),e.innerText="BOT",e},d=e=>{const t=document.createElement("span");return t.innerText=e.nick||e.username,t}})();
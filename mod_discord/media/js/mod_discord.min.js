(()=>{const e=e=>{const t=document.createElement("img");return t.setAttribute("src",e),t.classList.add("jj-discord-avatar"),t},t=()=>{const e=document.createElement("span");return e.classList.add("jj-discord-bot"),e.innerText="BOT",e},s=e=>{const t=document.createElement("span");return t.innerText=e.nick||e.username,t},d=Joomla.getOptions("discord"),n=document.getElementById("jj-discord"),c={method:"GET",mode:"cors",cache:"reload"};d.server.length>0&&fetch(`https://discordapp.com/api/guilds/${d.server}/widget.json`,c).then((c=>{200==c.status?c.json().then((c=>{const o=c.members;if(1==d.membersCount&&(document.getElementById("jj-discord-count").innerHTML=`<strong>${o.length}</strong> Members Online`),1==d.connect){const e=c.instant_invite.replace("https","discord");document.getElementById("jj-discord-connect").setAttribute("href",e)}const a={};if(c.channels.forEach((({id:e,position:t,name:s})=>{a[e]={position:t,name:s,members:[]}})),o.forEach((e=>{void 0!==e.channel_id&&a[e.channel_id].members.push(e)})),1==d.members){const n=document.getElementById("jj-discord-members");o.forEach((c=>{const o=document.createElement("li");o.classList.add("jj-flex","jj-flex-middle");const a=document.createElement("span");if("online"===c.status?a.classList.add("jj-discord-user-status","jj-discord-user-online"):"idle"===c.status?a.classList.add("jj-discord-user-status","jj-discord-user-idle"):a.classList.add("jj-discord-user-status","jj-discord-user-offline"),o.appendChild(e(c.avatar_url)),o.appendChild(a),o.appendChild(s(c)),c.bot&&o.appendChild(t()),1==d.game&&void 0!==c.game&&!c.bot){const e=document.createElement("span");e.classList.add("jj-discord-game"),e.innerText=` - ${c.game.name}`,o.appendChild(e)}n.appendChild(o)}))}Object.keys(a).forEach((e=>{a[a[e].position]=a[e],delete a[e]})),Object.keys(a).forEach((c=>{const o=a[c],i=document.createElement("li");i.innerText=o.name;const r=document.createElement("ul");o.members.forEach((n=>{const c=document.createElement("li");c.classList.add("jj-discord-user");const o=document.createElement("div");o.classList.add("jj-discord-user-start"),o.appendChild(e(n.avatar_url)),o.appendChild(s(n)),n.bot&&o.appendChild(t());const a=document.createElement("div");a.classList.add("jj-discord-user-end"),n.self_mute&&a.insertAdjacentHTML("beforeend",`<img src="${d.root}/media/mod_discord/images/microphone.svg" alt="">`),n.self_deaf&&a.insertAdjacentHTML("beforeend",`<img src="${d.root}/media/mod_discord/images/headset.svg" alt="">`),c.appendChild(o),c.appendChild(a),r.appendChild(c)})),i.appendChild(r),n.appendChild(i)}))})):console.log(c.status)})).catch((e=>{console.log(e)}))})();